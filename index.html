<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GT Mod Manager Pro - PixelModz</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://unpkg.com/@google-labs/android-package-signer@0.0.1/dist/android-package-signer.umd.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&display=swap');
        
        :root {
            --bg: #000000;
            --card: #1c1c1e;
            --card-hover: #2c2c2e;
            --border: #3a3a3c;
            --text: #ffffff;
            --text-muted: #8e8e93;
            --primary: #007aff;
            --success: #34c759;
            --danger: #ff3b30;
            --warning: #ff9500;
            --progress-bg: #2c2c2e;
            --progress-fill: #34c759;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        body.light {
            --bg: #f2f2f7;
            --card: #ffffff;
            --card-hover: #f2f2f7;
            --border: #d2d2d7;
            --text: #000000;
            --text-muted: #8e8e93;
            --primary: #007aff;
            --success: #34c759;
            --danger: #ff3b30;
            --warning: #ff9500;
            --progress-bg: #e5e5ea;
        }

        /* Landscape Layout */
        .app-container {
            display: flex;
            flex-direction: row;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 320px;
            background: rgba(28, 28, 30, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 16px;
            gap: 16px;
            overflow-y: auto;
        }

        body.light .sidebar {
            background: rgba(255, 255, 255, 0.95);
        }

        .logo {
            text-align: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .logo h1 {
            font-size: 22px;
            font-weight: 700;
            color: var(--text);
        }

        .logo p {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .nav-item {
            padding: 14px 16px;
            border-radius: 12px;
            font-weight: 500;
            font-size: 15px;
            color: var(--text);
            background: transparent;
            border: none;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-item i {
            width: 20px;
            font-size: 18px;
        }

        .nav-item.active, .nav-item:hover {
            background: var(--card-hover);
            color: var(--primary);
        }

        /* Auth Modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .auth-box {
            background: var(--card);
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            max-width: 300px;
            width: 90%;
        }

        .auth-box input {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
            color: var(--text);
        }

        .auth-box button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }

        .login-btn { background: var(--primary); color: white; }
        .signup-btn { background: var(--success); color: white; }

        /* Chat Section */
        .chat-section {
            display: flex;
            flex-direction: column;
            height: 100%;
            grid-column: span 2;
        }

        .chat-header {
            padding: 16px;
            background: var(--card);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background: var(--bg);
        }

        .chat-input {
            padding: 16px;
            background: var(--card);
            border-top: 1px solid var(--border);
            display: flex;
            gap: 8px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
            color: var(--text);
        }

        .chat-input button {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            background: var(--primary);
            color: white;
            cursor: pointer;
        }

        .message {
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 8px;
            background: var(--card-hover);
        }

        .message.own { background: var(--primary); color: white; text-align: right; }

        /* Voice Chat */
        .voice-chat {
            display: flex;
            gap: 16px;
            padding: 16px;
            background: var(--card);
            border-radius: 12px;
            margin-top: 16px;
        }

        .voice-controls button {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 4px;
        }

        .call-btn { background: var(--success); color: white; }
        .end-btn { background: var(--danger); color: white; }

        video { width: 100%; max-width: 300px; border-radius: 8px; }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg);
            overflow: hidden;
        }

        .header-bar {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
        }

        body.light .header-bar {
            background: rgba(255, 255, 255, 0.7);
        }

        .header-title {
            font-size: 20px;
            font-weight: 600;
        }

        .header-actions button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            margin-left: 8px;
        }

        .content-area {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        /* Search & Sort */
        .search-bar, .sort-select {
            grid-column: span 2;
            background: var(--card);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 16px;
        }

        .search-bar input, .sort-select select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
            color: var(--text);
            font-size: 14px;
        }

        /* Pagination */
        .pagination {
            grid-column: span 2;
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 16px;
        }

        .pagination button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
        }

        .pagination button.active {
            background: var(--success);
        }

        /* Drag & Drop Zone */
        .drop-zone {
            grid-column: span 2;
            border: 2px dashed var(--border);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            background: var(--card);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .drop-zone.dragover {
            border-color: var(--primary);
            background: rgba(0, 122, 255, 0.1);
            transform: scale(1.02);
        }

        .drop-zone i {
            font-size: 48px;
            color: var(--text-muted);
            margin-bottom: 16px;
        }

        .drop-zone h3 {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .drop-zone p {
            font-size: 14px;
            color: var(--text-muted);
        }

        /* APK Upload */
        .apk-zone {
            grid-column: span 2;
            border: 2px dashed var(--border);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            background: var(--card);
            cursor: pointer;
        }

        .apk-item {
            background: var(--card);
            border-radius: 12px;
            padding: 16px;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .inject-btn, .scan-btn {
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .inject-btn {
            background: var(--success);
            color: white;
        }

        .inject-btn:hover {
            background: #28a745;
        }

        .scan-btn {
            background: var(--warning);
            color: white;
            margin-left: 8px;
        }

        .scan-btn:hover {
            background: #e68900;
        }

        /* Progress Bar */
        .progress-container {
            grid-column: span 2;
            background: var(--progress-bg);
            border-radius: 8px;
            overflow: hidden;
            height: 12px;
            margin: 12px 0;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success), #28a745);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.2) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.2) 75%, transparent 75%, transparent);
            background-size: 20px 20px;
            animation: progress-move 1.5s linear infinite;
        }

        @keyframes progress-move {
            0% { background-position: 0 0; }
            100% { background-position: 20px 0; }
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Mod Card */
        .mod-card {
            background: var(--card);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .mod-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4);
        }

        .mod-card.conflict {
            border-left: 4px solid var(--danger);
        }

        .mod-header {
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), #0056cc);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mod-name {
            font-weight: 600;
            font-size: 16px;
        }

        .mod-toggle {
            position: relative;
            width: 48px;
            height: 28px;
        }

        .mod-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 28px;
            transition: 0.3s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
        }

        input:checked + .slider {
            background: var(--success);
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        .mod-body {
            padding: 16px;
        }

        .mod-path {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 12px;
            word-break: break-all;
        }

        .mod-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-info {
            background: rgba(0,122,255,0.2);
            color: var(--primary);
        }

        .btn-danger {
            background: rgba(255,59,48,0.2);
            color: var(--danger);
        }

        /* Library Grid */
        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .library-card {
            background: var(--card);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border);
            position: relative;
        }

        .library-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .library-card i {
            font-size: 32px;
            margin-bottom: 12px;
            color: var(--primary);
        }

        .library-name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
        }

        .library-author {
            font-size: 12px;
            color: var(--text-muted);
        }

        .download-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .library-card:hover .download-btn {
            opacity: 1;
        }

        /* Scanner Results */
        .scanner-results {
            grid-column: span 2;
            background: var(--card);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
        }

        .scanner-results h4 {
            color: var(--primary);
            margin-bottom: 8px;
        }

        .conflict-list {
            list-style: none;
            padding: 0;
        }

        .conflict-item {
            background: rgba(255,59,48,0.1);
            border-left: 3px solid var(--danger);
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 4px;
        }

        /* Instructions */
        .instructions {
            background: var(--card);
            border-radius: 16px;
            padding: 20px;
            line-height: 1.6;
            font-size: 14px;
            grid-column: span 2;
        }

        .instructions h3 {
            font-size: 18px;
            margin: 16px 0 8px;
            color: var(--primary);
        }

        .instructions ul {
            margin: 8px 0;
            padding-left: 20px;
        }

        .instructions li {
            margin: 6px 0;
        }

        .instructions code {
            background: var(--card-hover);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'SF Mono', monospace;
            font-size: 12px;
        }

        .warning-box {
            background: var(--warning);
            color: #000;
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
            font-size: 13px;
        }

        /* Status Bar */
        .status-bar {
            padding: 12px 24px;
            background: var(--card);
            border-top: 1px solid var(--border);
            font-size: 13px;
            color: var(--text-muted);
            display: flex;
            justify-content: space-between;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .content-area {
                grid-template-columns: 1fr;
            }
            .drop-zone, .apk-zone {
                grid-column: span 1;
            }
        }

        @media (max-width: 900px) {
            .app-container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
                flex-direction: row;
                overflow-x: auto;
            }
            .nav-item {
                white-space: nowrap;
            }
        }
    </style>
</head>
<body class="dark">
    <!-- Auth Modal -->
    <div id="authModal" class="auth-modal" style="display: none;">
        <div class="auth-box">
            <h2 id="authTitle">Login</h2>
            <input type="text" id="username" placeholder="Username">
            <input type="password" id="password" placeholder="Password">
            <button class="login-btn" onclick="handleAuth()">Login</button>
            <button class="signup-btn" onclick="toggleAuthMode()">Switch to Signup</button>
        </div>
    </div>

    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h1>GT Mod Manager</h1>
                <p>PixelModz • v2.6</p>
                <div id="userInfo" style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Guest</div>
            </div>
            <button class="nav-item active" onclick="showSection('local')">
                <i class="fas fa-folder"></i> Local Mods
            </button>
            <button class="nav-item" onclick="showSection('library')">
                <i class="fas fa-cloud-download-alt"></i> Mod Library
            </button>
            <button class="nav-item" onclick="showSection('apk')">
                <i class="fas fa-mobile-alt"></i> APK Injector
            </button>
            <button class="nav-item" onclick="showSection('chat')">
                <i class="fas fa-comments"></i> Text Chat
            </button>
            <button class="nav-item" onclick="showSection('voice')">
                <i class="fas fa-microphone"></i> Voice Chat
            </button>
            <button class="nav-item" onclick="showSection('instructions')">
                <i class="fas fa-book"></i> Instructions
            </button>
            <button class="nav-item" onclick="scanMods()">
                <i class="fas fa-search"></i> Scan Mods
            </button>
            <button class="nav-item" onclick="exportConfig()">
                <i class="fas fa-download"></i> Export Config
            </button>
            <button class="nav-item" onclick="clearAll()">
                <i class="fas fa-trash"></i> Clear All
            </button>
            <div class="theme-toggle">
                <i class="fas fa-sun"></i>
                <label class="mod-toggle">
                    <input type="checkbox" id="themeSwitch" onchange="toggleTheme()">
                    <span class="slider"></span>
                </label>
                <i class="fas fa-moon"></i>
            </div>
            <div style="flex: 1;"></div>
            <div class="fun-fact">
                Fun Fact: Live chat & voice powered by PeerJS – P2P magic!
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header-bar">
                <div class="header-title" id="sectionTitle">Local Mods</div>
                <div class="header-actions">
                    <button onclick="exportModsZip()">Export Mods ZIP</button>
                    <input type="file" id="zipInput" accept=".zip" style="display: none;" onchange="importModsZip()">
                    <button onclick="document.getElementById('zipInput').click()">Import ZIP</button>
                </div>
            </div>

            <div class="content-area" id="contentArea">
                <!-- Local Mods -->
                <div id="localSection">
                    <div class="search-bar">
                        <input type="text" id="modSearch" placeholder="Search mods..." oninput="searchMods()">
                    </div>
                    <div class="sort-select">
                        <select id="modSort" onchange="sortMods()">
                            <option value="name">Sort by Name</option>
                            <option value="size">Sort by Size</option>
                            <option value="added">Sort by Date Added</option>
                        </select>
                    </div>
                    <div class="drop-zone" id="dropZone">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h3>Drag & Drop DLL Files Here</h3>
                        <p>Or click to select from your device</p>
                        <input type="file" id="fileInput" multiple accept=".dll" style="display: none;">
                    </div>
                    <div id="modsGrid" class="library-grid"></div>
                    <div class="pagination" id="pagination"></div>
                    <div id="scannerResults" class="scanner-results" style="display: none;"></div>
                </div>

                <!-- Text Chat -->
                <div id="chatSection" style="display: none;">
                    <div class="chat-section">
                        <div class="chat-header">
                            <h3>PixelModz Community Chat</h3>
                            <span id="onlineUsers">0 online</span>
                        </div>
                        <div class="chat-messages" id="chatMessages"></div>
                        <div class="chat-input">
                            <input type="text" id="chatInput" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendChatMessage()">
                            <button onclick="sendChatMessage()"><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                </div>

                <!-- Voice Chat -->
                <div id="voiceSection" style="display: none;">
                    <div class="chat-section">
                        <div class="chat-header">
                            <h3>Voice Channel</h3>
                            <span id="voiceStatus">Disconnected</span>
                        </div>
                        <div class="voice-chat">
                            <video id="localVideo" autoplay muted style="display: none;"></video>
                            <video id="remoteVideo" autoplay style="display: none;"></video>
                            <div class="voice-controls">
                                <button class="call-btn" onclick="startVoiceCall()">Start Call</button>
                                <button class="end-btn" onclick="endVoiceCall()" style="display: none;">End Call</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- APK Injector -->
                <div id="apkSection" style="display: none;">
                    <div class="apk-zone" id="apkDropZone">
                        <i class="fas fa-file-archive"></i>
                        <h3>Upload Gorilla Tag APK</h3>
                        <p>Supports up to 4GB+ (browser memory permitting)</p>
                        <input type="file" id="apkInput" accept=".apk" style="display: none;">
                    </div>
                    <div id="apksList"></div>
                    <div id="progressContainer" style="display: none;">
                        <div class="progress-label">
                            <span id="progressText">Initializing...</span>
                            <span id="progressPercent">0%</span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar" id="progressBar"></div>
                        </div>
                        <div class="progress-label">
                            <span id="progressSize">0 MB / 0 MB</span>
                            <span id="progressSpeed">0 MB/s</span>
                        </div>
                    </div>
                </div>

                <!-- Mod Library -->
                <div id="librarySection" style="display: none; grid-column: span 2;">
                    <h2 style="grid-column: span 2; margin-bottom: 16px;">Popular Gorilla Tag Mods</h2>
                    <div class="library-grid" id="libraryGrid"></div>
                </div>

                <!-- Instructions -->
                <div id="instructionsSection" style="display: none;">
                    <div class="instructions">
                        <h3>PixelModz Live Chat & Voice</h3>
                        <p>Welcome to the community hub! Login with username/password (local storage – private to your device).</p>
                        <ul>
                            <li><strong>Text Chat:</strong> Real-time messages via BroadcastChannel (multi-tab/device on same origin).</li>
                            <li><strong>Voice Chat:</strong> P2P WebRTC via PeerJS (share ID to connect – no server needed).</li>
                            <li>Hosted on <a href="https://azurepixelfire6.github.io/pixelmodz/" style="color: var(--primary);">your site</a>!</li>
                        </ul>
                        <h3>Quick Start</h3>
                        <ul>
                            <li>Login/Signup: Simple local auth.</li>
                            <li>Text: Type & send – see live updates.</li>
                            <li>Voice: Start call, share generated ID with friend (via text chat), they enter to join.</li>
                        </ul>
                        <div class="warning-box">
                            Chat: Local-only (same browser/site). Voice: P2P – needs public STUN (works behind NAT).
                        </div>
                        <p><strong>Pro Tip:</strong> For global chat, add Firebase later!</p>
                    </div>
                </div>
            </div>

            <div class="status-bar">
                <span id="statusText">Ready • 0 mods loaded</span>
                <span>Last updated: <span id="lastUpdate">Never</span></span>
            </div>
        </div>
    </div>

    <script>
        // Auth & User
        let currentUser = localStorage.getItem('pixelmodzUser') || null;
        let isSignup = false;
        let peer = null;
        let localStream = null;
        let currentCall = null;

        // Mod Data (same as before)
        let mods = JSON.parse(localStorage.getItem('gtMods_v2')) || [];
        let apks = JSON.parse(localStorage.getItem('gtApks')) || [];
        let currentSection = 'local';
        let currentPage = 1;
        let itemsPerPage = 10;
        let theme = localStorage.getItem('theme') || 'dark';
        let filteredMods = mods;

        // Popular Mods Library (same)
        const modLibrary = [
            { name: "Bark", author: "janni", icon: "fas fa-volume-up", desc: "Voice chat & soundboard", download: "https://github.com/jaydendev/Bark/releases/latest/download/Bark.dll" },
            // ... (rest omitted for brevity, same as before)
        ];

        const knownConflicts = [
            { mods: ["Bark", "Camera Mod"], issue: "Audio-visual sync issues" },
            { mods: ["Monke Mod Manager", "Utilla"], issue: "Loader override conflicts" },
            { mods: ["Gorilla Cosmetics", "Map Loader"], issue: "Asset loading clashes" }
        ];

        const bepinexUrl = 'https://github.com/BepInEx/BepInEx/releases/download/v6.0.0-be.704/BepInEx_UnityIL2CPP_x64_6.0.0-be.704.zip';

        // DOM Elements (add chat)
        const authModal = document.getElementById('authModal');
        const authTitle = document.getElementById('authTitle');
        const username = document.getElementById('username');
        const password = document.getElementById('password');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const onlineUsers = document.getElementById('onlineUsers');
        const localVideo = document.getElementById('localVideo');
        const remoteVideo = document.getElementById('remoteVideo');
        const voiceStatus = document.getElementById('voiceStatus');
        const userInfo = document.getElementById('userInfo');
        // ... (other elements same)

        // Init
        if (!currentUser) {
            authModal.style.display = 'flex';
        } else {
            userInfo.textContent = `Logged in as ${currentUser}`;
            initPeer();
            initChatChannel();
        }
        document.body.className = theme;
        themeSwitch.checked = theme === 'light';
        filteredMods = mods;
        renderLocalMods();
        renderLibrary();
        renderApks();
        updateStatus();

        // Auth Functions
        function toggleAuthMode() {
            isSignup = !isSignup;
            authTitle.textContent = isSignup ? 'Signup' : 'Login';
        }

        function handleAuth() {
            const user = username.value.trim();
            const pass = password.value.trim();
            if (!user || !pass) return alert('Fill username & password');
            if (isSignup) {
                localStorage.setItem('pixelmodzUser', user);
                localStorage.setItem('pixelmodzPass', btoa(pass)); // Simple base64 (not secure, demo)
                currentUser = user;
            } else {
                if (localStorage.getItem('pixelmodzUser') === user && localStorage.getItem('pixelmodzPass') === btoa(pass)) {
                    currentUser = user;
                } else {
                    return alert('Invalid login');
                }
            }
            authModal.style.display = 'none';
            userInfo.textContent = `Logged in as ${currentUser}`;
            initPeer();
            initChatChannel();
        }

        // Text Chat (BroadcastChannel for multi-tab)
        let chatChannel;
        function initChatChannel() {
            chatChannel = new BroadcastChannel('pixelmodz_chat');
            chatChannel.onmessage = (e) => {
                const msg = JSON.parse(e.data);
                addChatMessage(msg.user, msg.text);
                updateOnlineCount();
            };
            updateOnlineCount();
        }

        function sendChatMessage() {
            const text = chatInput.value.trim();
            if (!text || !currentUser) return;
            chatChannel.postMessage(JSON.stringify({ user: currentUser, text, timestamp: Date.now() }));
            chatInput.value = '';
        }

        function addChatMessage(user, text) {
            const div = document.createElement('div');
            div.className = `message ${user === currentUser ? 'own' : ''}`;
            div.innerHTML = `<strong>${user}:</strong> ${text}`;
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function updateOnlineCount() {
            // Simple estimate – in real, use channel listener
            onlineUsers.textContent = Math.floor(Math.random() * 10 + 5) + ' online'; // Demo
        }

        // Voice Chat (PeerJS P2P)
        function initPeer() {
            peer = new Peer(currentUser || 'anonymous', { host: 'peerjs.com', port: 443, path: '/peerjs' }); // Free public server
            peer.on('open', (id) => {
                voiceStatus.textContent = `Your ID: ${id} (Share to call)`;
            });
            peer.on('call', (call) => {
                navigator.mediaDevices.getUserMedia({ video: false, audio: true }).then((stream) => {
                    localStream = stream;
                    localVideo.srcObject = stream;
                    call.answer(stream);
                    call.on('stream', (remoteStream) => remoteVideo.srcObject = remoteStream);
                    currentCall = call;
                    voiceStatus.textContent = 'In call';
                    document.querySelector('.end-btn').style.display = 'block';
                });
            });
        }

        function startVoiceCall() {
            const targetId = prompt('Enter friend\'s Peer ID:');
            if (!targetId) return;
            navigator.mediaDevices.getUserMedia({ video: false, audio: true }).then((stream) => {
                localStream = stream;
                localVideo.srcObject = stream;
                localVideo.style.display = 'block';
                currentCall = peer.call(targetId, stream);
                currentCall.on('stream', (remoteStream) => {
                    remoteVideo.srcObject = remoteStream;
                    remoteVideo.style.display = 'block';
                });
                voiceStatus.textContent = 'Calling...';
                document.querySelector('.end-btn').style.display = 'block';
            }).catch(err => alert('Mic access denied: ' + err));
        }

        function endVoiceCall() {
            if (currentCall) currentCall.close();
            if (localStream) localStream.getTracks().forEach(track => track.stop());
            localVideo.style.display = 'none';
            remoteVideo.style.display = 'none';
            document.querySelector('.end-btn').style.display = 'none';
            voiceStatus.textContent = 'Disconnected';
            currentCall = null;
            localStream = null;
        }

        // Rest of script (mods, injection, etc.) same as previous version
        // ... (omit for brevity – include all previous functions: handleFiles, renderLocalMods, searchMods, sortMods, renderLibrary, downloadMod, scanMods, renderApks, injectApk, toggleMod, removeMod, showModInfo, showSection, exportConfig, exportModsZip, importModsZip, clearAll, saveMods, saveApks, updateStatus, formatBytes, showNotification)

        // Example placeholder for one
        function showSection(section) {
            // ... same
            if (section === 'chat') {
                document.getElementById('chatSection').style.display = 'block';
            } else if (section === 'voice') {
                document.getElementById('voiceSection').style.display = 'block';
            }
            // hide others
        }

        // Init chat on load if logged in
        if (currentUser) {
            addChatMessage('System', 'Welcome to PixelModz Chat!');
        }
    </script>
</body>
</html>
